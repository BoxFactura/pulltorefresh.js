!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.PullToRefresh=t()}(this,function(){var e={distThreshold:60,distMax:80,distReload:50,bodyOffset:20,mainElement:"body",triggerElement:"body",ptrElement:".ptr",classPrefix:"ptr--",cssProp:"min-height",iconArrow:"&#8675;",iconRefreshing:"&hellip;",instructionsPullToRefresh:"Pull down to refresh",instructionsReleaseToRefresh:"Release to refresh",instructionsRefreshing:"Refreshing",refreshTimeout:500,getMarkup:function(){return'\n<div class="__PREFIX__box">\n  <div class="__PREFIX__content">\n    <div class="__PREFIX__icon"></div>\n    <div class="__PREFIX__text"></div>\n  </div>\n</div>'},getStyles:function(){return".__PREFIX__ptr {\n  box-shadow: inset 0 -3px 5px rgba(0, 0, 0, 0.12);\n  pointer-events: none;\n  font-size: 0.85em;\n  font-weight: bold;\n  top: 0;\n  height: 0;\n  transition: height 0.3s, min-height 0.3s;\n  text-align: center;\n  width: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: flex-end;\n  align-content: stretch;\n}\n.__PREFIX__box {\n  padding: 10px;\n  flex-basis: 100%;\n}\n.__PREFIX__pull {\n  transition: none;\n}\n.__PREFIX__text {\n  margin-top: .33em;\n  color: rgba(0, 0, 0, 0.3);\n}\n.__PREFIX__icon {\n  color: rgba(0, 0, 0, 0.3);\n  transition: transform .3s;\n}\n.__PREFIX__top {\n  touch-action: pan-x pan-down pinch-zoom;\n}\n.__PREFIX__release .__PREFIX__icon {\n  transform: rotate(180deg);\n}\n"},onInit:function(){},onRefresh:function(){return location.reload()},resistanceFunction:function(e){return Math.min(1,e/2.5)},shouldPullToRefresh:function(){return!window.scrollY}},t=["mainElement","ptrElement","triggerElement"],n={pullStartY:null,pullMoveY:null,handlers:[],styleEl:null,events:null,dist:0,state:"pending",timeout:null,distResisted:0,supportsPassive:!1};try{window.addEventListener("test",null,{get passive(){n.supportsPassive=!0}})}catch(e){}var s={setupDOM:function(e){if(!e.ptrElement){var t=document.createElement("div");e.mainElement!==document.body?e.mainElement.parentNode.insertBefore(t,e.mainElement):document.body.insertBefore(t,document.body.firstChild),t.classList.add(e.classPrefix+"ptr"),t.innerHTML=e.getMarkup().replace(/__PREFIX__/g,e.classPrefix),e.ptrElement=t,"function"==typeof e.onInit&&e.onInit(e),n.styleEl||(n.styleEl=document.createElement("style"),n.styleEl.setAttribute("id","pull-to-refresh-js-style"),document.head.appendChild(n.styleEl)),n.styleEl.textContent=e.getStyles().replace(/__PREFIX__/g,e.classPrefix).replace(/\s+/g," ")}return e},onReset:function(e){e.ptrElement.classList.remove(e.classPrefix+"refresh"),e.ptrElement.style[e.cssProp]="0px",setTimeout(function(){e.ptrElement&&e.ptrElement.parentNode&&(e.ptrElement.parentNode.removeChild(e.ptrElement),e.ptrElement=null),n.state="pending"},e.refreshTimeout)},update:function(e){var t=e.ptrElement.querySelector("."+e.classPrefix+"icon"),s=e.ptrElement.querySelector("."+e.classPrefix+"text");t&&("refreshing"===n.state?t.innerHTML=e.iconRefreshing:t.innerHTML=e.iconArrow),s&&("releasing"===n.state&&(s.innerHTML=e.instructionsReleaseToRefresh),"pulling"!==n.state&&"pending"!==n.state||(s.innerHTML=e.instructionsPullToRefresh),"refreshing"===n.state&&(s.innerHTML=e.instructionsRefreshing))}};function r(){var e;function t(t){var r=n.handlers.filter(function(e){return e.contains(t.target)})[0];n.enable=!!r,r&&"pending"===n.state&&(e=s.setupDOM(r),r.shouldPullToRefresh()&&(n.pullStartY=t.touches[0].screenY),clearTimeout(n.timeout),s.update(r))}function r(t){e&&e.ptrElement&&n.enable&&(n.pullStartY?n.pullMoveY=t.touches[0].screenY:e.shouldPullToRefresh()&&(n.pullStartY=t.touches[0].screenY),"refreshing"!==n.state?("pending"===n.state&&(e.ptrElement.classList.add(e.classPrefix+"pull"),n.state="pulling",s.update(e)),n.pullStartY&&n.pullMoveY&&(n.dist=n.pullMoveY-n.pullStartY),n.dist>0&&(t.preventDefault(),e.ptrElement.style[e.cssProp]=n.distResisted+"px",n.distResisted=e.resistanceFunction(n.dist/e.distThreshold)*Math.min(e.distMax,n.dist),"pulling"===n.state&&n.distResisted>e.distThreshold&&(e.ptrElement.classList.add(e.classPrefix+"release"),n.state="releasing",s.update(e)),"releasing"===n.state&&n.distResisted<e.distThreshold&&(e.ptrElement.classList.remove(e.classPrefix+"release"),n.state="pulling",s.update(e)))):e.shouldPullToRefresh()&&n.pullStartY<n.pullMoveY&&t.preventDefault())}function i(){if(e&&e.ptrElement&&n.enable){if("releasing"===n.state&&n.distResisted>e.distThreshold)n.state="refreshing",e.ptrElement.style[e.cssProp]=e.distReload+"px",e.ptrElement.classList.add(e.classPrefix+"refresh"),n.timeout=setTimeout(function(){var t=e.onRefresh(function(){return s.onReset(e)});t&&"function"==typeof t.then&&t.then(function(){return s.onReset(e)}),t||e.onRefresh.length||s.onReset(e)},e.refreshTimeout);else{if("refreshing"===n.state)return;e.ptrElement.style[e.cssProp]="0px",n.state="pending"}s.update(e),e.ptrElement.classList.remove(e.classPrefix+"release"),e.ptrElement.classList.remove(e.classPrefix+"pull"),n.pullStartY=n.pullMoveY=null,n.dist=n.distResisted=0}}function o(){e&&e.mainElement.classList.toggle(e.classPrefix+"top",e.shouldPullToRefresh())}var l=n.supportsPassive?{passive:n.passive||!1}:void 0;return window.addEventListener("touchend",i),window.addEventListener("touchstart",t),window.addEventListener("touchmove",r,l),window.addEventListener("scroll",o),{onTouchEnd:i,onTouchStart:t,onTouchMove:r,onScroll:o,destroy:function(){window.removeEventListener("touchstart",t),window.removeEventListener("touchend",i),window.removeEventListener("touchmove",r,l),window.removeEventListener("scroll",o)}}}function i(s){var i={};return Object.keys(e).forEach(function(t){i[t]=s[t]||e[t]}),i.refreshTimeout="number"==typeof s.refreshTimeout?s.refreshTimeout:e.refreshTimeout,t.forEach(function(e){"string"==typeof i[e]&&(i[e]=document.querySelector(i[e]))}),n.events||(n.events=r()),i.contains=function(e){return i.triggerElement.contains(e)},i.destroy=function(){clearTimeout(n.timeout),n.handlers.splice(i.offset,1)},i}return{setPassiveMode:function(e){n.passive=e},destroyAll:function(){n.events&&(n.events.destroy(),n.events=null),n.handlers.forEach(function(e){e.destroy()})},init:function(e){void 0===e&&(e={});var t=i(e);return t.offset=n.handlers.push(t)-1,t},_:{setupHandler:i,setupEvents:r,setupDOM:s.setupDOM,onReset:s.onReset,update:s.update}}});
